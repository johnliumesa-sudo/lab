#+TITLE: Roblox Game Design Document
#+AUTHOR: Aaron Liu
#+DESCRIPTION: A master literate programming file for the Coin Collection game.
* server
** collectables
*** coins
**** CoinManager
:properties:
:header-args:lua: :tangle ./src/server/Collectables/CoinManager.server.luau
:END:
***** notes
Spawns the coins into the world.
***** code
****** variables
#+begin_src lua
  local coin = game:GetService("ReplicatedStorage"):FindFirstChild("Collectables"):FindFirstChild("Coins"):WaitForChild("Part")
  local coinScript = script.Parent:FindFirstChild("CoinScript")
  coinScript.Parent = coin
  local coinsFolder = game:GetService("Workspace"):FindFirstChild("Collectables"):FindFirstChild("Coins")
  local spawnRange = 48
  local coinCount = 21
#+end_src
****** functions
******* randomSpawn
#+begin_src lua
  local function randomSpawn()
    local xpos = math.random (-spawnRange, spawnRange)
    local zpos = math.random (-spawnRange, spawnRange)
    local ypos = math.random (5, 30)
    local coinClone = coin:Clone()
    coinClone.Parent = coinsFolder
    coinClone.Position = Vector3.new(xpos,ypos,zpos)
    local coinScriptClone = coinClone:WaitForChild("CoinScript")
    coinScriptClone.Parent = coinClone
    return
  end
#+end_src
******* movements
#+begin_src lua
  local function movements(collectablesClone)
    local spinRate = math.rad
    while true do
  	-- Movement logic placeholder
    end
  end
#+end_src
****** executions
#+begin_src lua
  for i = 1, coinCount do
      randomSpawn()
  end
#+end_src
**** CoinScript
:properties:
:header-args:lua: :tangle ./src/server/Collectables/CoinScript.server.luau
:END:
***** notes
Defines individual coin behavior (rotate, touch, reward).
***** code
****** variables
#+begin_src lua
  local coinBase = Instance.new("Part")
  coinBase.Parent =  game:GetService("ReplicatedStorage"):FindFirstChild("Collectables"):FindFirstChild("Coins")
  coinBase.Anchored = true
  local coin = Instance.new ("SpecialMesh")
  coin.Parent = coinBase
  coin.MeshId = "rbxassetid://71877336332186"
  coin.TextureId = "rbxassetid://9460443119"
  local rotationRate = 3
  local Players = game:GetService("Players")
  local coinFolder = game:GetService("Workspace"):FindFirstChild("Collectables"):FindFirstChild("Coins")
#+end_src
****** functions
******* rotate 
#+begin_src lua
  local function rotate()
      script.Parent.CFrame *= CFrame.Angles(0, rotationRate, 0)  
  end
#+end_src
******* onTouched
#+begin_src lua
  local function onTouched(otherPart)
      local character = otherPart.Parent
      local humanoid = character:FindFirstChildWhichIsA("Humanoid")
      if humanoid then
  	local player = Players:GetPlayerFromCharacter(character)
  	local leaderstats = player:WaitForChild("leaderstats")
  	script.Parent:Destroy()
  	leaderstats.CoinCount.Value += 10
      end
  end
#+end_src
****** executions
#+begin_src lua
  game:GetService("RunService").Heartbeat:Connect(rotate)

  if script.Parent.Parent == coinFolder then
    script.Parent.Touched:Connect(onTouched)
  end
#+end_src
** npcs
*** patrols
**** PatrolManager
:properties:
:header-args:lua: :tangle ./src/server/NPCs/PatrolManager.server.luau
:END:
***** notes
Spawns the Patrol NPCs.
***** code
****** variables
#+begin_src lua
  local patrol = game:GetService("ReplicatedStorage"):FindFirstChild("NPCs"):FindFirstChild("Patrols"):WaitForChild("Model")
  local patrolScript = script.Parent:FindFirstChild("PatrolScript")
  patrolScript.Parent = patrol
  local patrolFolder =  game:GetService("Workspace"):FindFirstChild("NPCs") :FindFirstChild("Patrols") 
  local spawnRange = 96
  local patrolCount = 24
#+end_src
****** functions
******* randomSpawn
#+begin_src lua
  local function  randomSpawn(index)
      local xpos = math.random (-spawnRange, spawnRange)
      local zpos = math.random (-spawnRange, spawnRange)
      local ypos = 4
      local patrolClone = patrol:Clone()
      patrolClone.Parent = patrolFolder
      patrolClone.Name = ("patrolClone_" .. tostring(index))
      patrolClone.PrimaryPart = patrolClone:FindFirstChild("HumanoidRootPart")
      patrolClone:PivotTo(CFrame.new(xpos,ypos,zpos))
      return  
  end
#+end_src
****** executions
#+begin_src lua
  for i = 1, patrolCount do
      randomSpawn(i)
  end
#+end_src
**** PatrolScript
:PROPERTIES:
:header-args:lua: :tangle ./src/server/NPCs/PatrolScript.server.luau
:END:
***** notes
FIXED LOGIC: This script builds the NPC body on the existing model (script.Parent) instead of creating a new ghost model in storage. This ensures hrp.Touched actually works in the Workspace.
***** code
****** variables
#+begin_src lua
  local StartingPosition = Vector3.new(0, 5, 0)
  local Players = game:GetService("Players")
#+end_src
****** functions
******* setupPatrolBody
#+begin_src lua
  local function createPatrol()
      local patrol = Instance.new("Model")
      patrol.Parent = game:GetService("ReplicatedStorage"):FindFirstChild("NPCs"):FindFirstChild("Patrols")
      
      local hrp = Instance.new("Part")
      hrp.Name = "HumanoidRootPart"
      hrp.Size = Vector3.new(2, 2, 1)
      hrp.Transparency = 1
      hrp. CFrame = CFrame.new(StartingPosition)
      hrp.Anchored = false
      hrp.Parent = patrol
      hrp.CanCollide = true
      
      local humanoid = Instance.new("Humanoid")
      humanoid.Parent = patrol
      humanoid.WalkSpeed = 16
      humanoid.JumpPower = 50
      humanoid.Health = 100

      patrol.PrimaryPart = hrp

      local torso = Instance.new("Part")
      torso.Name = "Torso"
      torso.Size = Vector3.new(2, 2, 1)
      torso.Color = Color3.new(1, 0, 0) -- Red color for visibility
      torso.Parent = patrol

      local head = Instance.new("Part")
      head.Name = "Head"
      head.Size = Vector3.new(1, 1, 1)
      head.Color = Color3.new(1, 0.8, 0.6) -- Skin color
      head.Parent = patrol
      
      local headMesh = Instance.new("SpecialMesh")
      headMesh.MeshType = Enum.MeshType.Head
      headMesh.Parent = head

      local weld_hrp_torso = Instance.new("WeldConstraint")
      weld_hrp_torso.Part0 = hrp
      weld_hrp_torso.Part1 = torso
      weld_hrp_torso.Parent = hrp

      torso.CFrame = hrp.CFrame * CFrame.new(0, 1.5, 0)
      head.CFrame = torso.CFrame * CFrame.new(0, 2, 0)

      local weld_head_tosro = Instance.new("WeldConstraint")
      weld_head_tosro.Part0 = head
      weld_head_tosro.Part1 = torso
      weld_head_tosro.Parent = torso

      return patrol, hrp, humanoid,torso
  end
#+end_src
******* onTouched
#+begin_src lua
  local function onTouched(otherPart)
      local character = otherPart.Parent
      local humanoid = character:FindFirstChildWhichIsA("Humanoid")
      if humanoid then
          local player = Players:GetPlayerFromCharacter(character)  -- Character's parent is the Player
          local leaderstats = player:FindFirstChild("leaderstats")
          local coinCount = leaderstats:WaitForChild("CoinCount")
          leaderstats.CoinCount.Value -= 3
          script.Parent:FindFirstChild("HumanoidRootPart").CanTouch = false
          script.Parent:FindFirstChild("Torso").Color = Color3.new(0.152941, 0.784313, 0.117647) 
          if coinCount.Value < 0 then
              humanoid.Health = 0
              coinCount.Value = 0
          end
          task.wait(5)
          script.Parent:FindFirstChild("Torso").Color = Color3.new(1, 0, 0)
          script.Parent:FindFirstChild("HumanoidRootPart").CanTouch = true 
      end
  end
#+end_src
****** executions
#+begin_src lua
  local patrol, hrp, humanoid,torso = createPatrol()
  if script.Parent.Parent == game.Workspace:FindFirstChild("NPCs"):FindFirstChild("Patrols") then
      script.Parent:FindFirstChild("HumanoidRootPart").Touched:Connect(onTouched)
  end
#+end_src
** obstacles
** tools
*** rockets
** ui
*** leaderboard
**** LeaderboardManager
:properties:
:header-args:lua: :tangle ./src/server/UI/LeaderboardManager.server.luau
:END:
***** notes
Standard leaderboard setup to track coins.
***** code
****** variables
#+begin_src lua
local players = game:GetService("Players")
#+end_src
****** functions
******* onPlayerSpawn
#+begin_src lua
local function onPlayerSpawn(player)
local leaderstats = Instance.new("Folder")
leaderstats.Name = "leaderstats"
leaderstats.Parent = player
local coinCount = Instance.new("IntValue")
coinCount.Name = "CoinCount"
coinCount.Parent = leaderstats
coinCount.Value = 0
end
#+end_src
****** executions
#+begin_src lua
players.PlayerAdded:Connect(onPlayerSpawn)
#+end_src
* shared 
* workspace 
